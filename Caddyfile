{
	auto_https off
}

:8080 {
	log {
		output stdout
		format console
	}
	
	encode zstd gzip

	# Preserve real client IP from Cloudflare
	header_up X-Real-IP {http.request.header.CF-Connecting-IP}
	header_up X-Forwarded-For {http.request.header.CF-Connecting-IP}
	
	# MinIO console (subdomain)
	@minioConsole host minio.fibeger.com
	reverse_proxy @minioConsole minio:9001

	# MinIO S3 API under /minio on apex
	@minioAPI path /minio*
	handle @minioAPI {
		uri strip_prefix /minio
		reverse_proxy minio:9000
	}

	# Default: Next.js app (everything else)
	reverse_proxy app:3000
}
