{
	auto_https off
}

http://127.0.0.1:8080 {
	log {
		output stdout
		format console
	}
	
	encode zstd gzip

	# Preserve real client IP from Cloudflare
	request_header X-Real-IP {http.request.header.CF-Connecting-IP}
	request_header X-Forwarded-For {http.request.header.CF-Connecting-IP}
	request_header X-Forwarded-Proto {scheme}
	request_header Host {host}

	# MinIO console (subdomain)
	@minioConsole host minio.fibeger.com
	handle @minioConsole {
		reverse_proxy minio:9001
	}

	# MinIO S3 API under /minio on apex
	handle /minio/* {
		uri strip_prefix /minio
		reverse_proxy minio:9000
	}

	# Default: Next.js app (catch-all)
	handle {
		reverse_proxy app:3000
	}
}
